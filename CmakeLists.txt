project(Spp)

cmake_minimum_required(VERSION 3.16)

set(CMAKE_CXX_STANDARD 20)
set(CMAKE_CXX_STANDARD_REQUIRED ON)


# Google test
add_subdirectory(extern/gtest)
include(GoogleTest)

macro(spp_test _target _src _test_src)
  set(_all_src "${_src}" "${_test_src}")
  message(STATUS "Setting tests for ${_target}")
  message(STATUS "src: ${_src}")
  message(STATUS "test src: ${_test_src}")
  add_executable(${_target} "${_all_src}")
  target_link_libraries("${_target}" gtest_main)
  unset(_all_src)
endmacro()

set(_RATIONAL_SRC "ast/smart_num/rational/rational.h" "util/concept.h")
set(_RATIONAL_TEST_SRC "ast/smart_num/rational/test.cpp")

set(_SMART_NUM_SRC "ast/smart_num/smart_num.h" "util/concept.h" "${_RATIONAL_SRC}")
set(_SMART_NUM_TEST_SRC "ast/smart_num/test.cpp")

spp_test(rational_test "${_RATIONAL_SRC}" "${_RATIONAL_TEST_SRC}")
spp_test(smart_num_test "${_SMART_NUM_SRC}" "${_SMART_NUM_TEST_SRC}")

set(_AST_SRC "ast/operator/base.h" "ast/ast.h" "ast/operator/neg.h" 
"ast/operator/add.h" "ast/operator/sub.h" "ast/operator/mul.h" "ast/operator/div.h"
"ast/operand/base.h" "ast/operand/number.h" "ast/node.h"
"${_SMART_NUM_SRC}")

set(_AST_TEST_SRC "ast/test.cpp" "${_AST_SRC}")

spp_test(ast_test "${_AST_SRC}" "${_AST_TEST_SRC}")

